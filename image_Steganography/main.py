__author__ = 'Nerya Yekutiel'

import cv2
import image_Steganography.methods as methods
import numpy as np
from matplotlib import pyplot as plt
import re

# myImg = cv2.imread("images/cat1_1638x2048_bmp.bmp")
# myImg = cv2.imread("images/scenic_2200x1200_jpg.jpg")

# key = 255
# methods.showImg(myImg, 255, "Original Image")
#
# methods.showImgAndHistogram(myImg, 3, "Zeroed 6 MSB")
#
# methods.showImgAndHistogram(myImg, 15, "Zeroed 4 MSB")
#
# methods.showImgAndHistogram(myImg, 127, "Zeroed 1 MSB")

# methods.showImgAndHistogram(myImg, 252, "Zeroed 2 LSB")

# methods.showImgAndHistogram(myImg.copy(), 240, "Zeroed only R 4 LSB")
# #
# methods.showImgAndHistogram(myImg, 255, "Original Image")


#####
# Very long text for your convenience
# text = "Id orci mi dapibus congue lectus blandit pellentesque nec phasellus in sociis ante. Molestie egestas. Laoreet ac facilisis torquent dapibus aliquet venenatis nonummy maecenas consectetuer. Amet quis, congue nostra. Imperdiet imperdiet aenean nam turpis tristique dis fermentum purus montes litora luctus adipiscing eleifend. Semper odio mauris netus augue luctus libero dictum convallis. Turpis sed, fermentum lobortis eu hymenaeos nisi placerat. Dapibus venenatis tempus cubilia enim lorem, dui quis natoque. Neque ac semper parturient urna ut primis ultricies. Urna et parturient purus nunc integer facilisis. Sem semper conubia ultrices nunc cubilia sodales molestie sem porttitor convallis sodales justo fermentum arcu etiam. Aenean tortor dolor. Est praesent congue vivamus. Eget adipiscing vel fusce ridiculus. Sociis Sed pede quis tellus. Ac suspendisse et leo tempor non commodo parturient nullam scelerisque hac tempus. Sed arcu eleifend lectus magna mus fames dictum imperdiet porttitor felis dictum In vehicula tincidunt phasellus penatibus facilisis Volutpat Malesuada eu rhoncus augue faucibus morbi, tortor nunc dictum hac ultrices senectus hymenaeos iaculis. Dignissim litora dolor sociis mi vulputate parturient metus iaculis felis nullam. Taciti curabitur magnis. Congue egestas hendrerit hac class morbi faucibus. Arcu taciti neque congue curae; donec dis ad natoque non natoque placerat tristique sociis interdum sollicitudin purus metus feugiat placerat fermentum, aliquet ullamcorper Montes tincidunt molestie tincidunt, gravida. Tempus maecenas ornare turpis suspendisse diam nonummy, integer vestibulum tempus nostra praesent tincidunt elementum sociis urna mi aliquet sagittis tincidunt. Donec fames penatibus amet lobortis sed metus id condimentum Volutpat inceptos nonummy ultricies maecenas. In ac nulla hendrerit porttitor ornare pulvinar libero enim potenti sociis orci semper lorem ut pharetra amet lacinia, odio sapien Sociosqu, curae;. Vestibulum mi. Tristique nisl suspendisse quam nec justo augue. Sociis ultrices sapien vitae tempor montes nisl nonummy quisque semper ultrices non feugiat pulvinar mus vulputate. Fermentum arcu Nam porttitor posuere fusce duis Diam sociosqu, luctus blandit cum. Accumsan Mauris velit, nibh eleifend fringilla laoreet volutpat nibh gravida et quisque suscipit. Ridiculus torquent porta ultricies per. Convallis ligula pulvinar. Consequat placerat imperdiet ipsum massa Donec nonummy sodales a dictum etiam arcu aliquam ligula vel inceptos. Tincidunt tempus at congue maecenas porttitor inceptos iaculis morbi class hendrerit. Lacinia rhoncus hac sit. Porttitor. Nunc erat ac rutrum venenatis platea aliquam cubilia laoreet Quisque sapien adipiscing, nec commodo. Aenean adipiscing malesuada consectetuer bibendum netus ut donec ultricies curabitur ut nam blandit blandit vestibulum lectus lacinia ridiculus. Nascetur. Hac facilisi curae; lacinia, praesent. Nullam ornare netus augue. Massa per velit litora augue commodo quis tempor at, interdum ultricies urna senectus tortor bibendum nisl est senectus sed. Arcu curae; ante, turpis, quam mus. Natoque commodo malesuada etiam pellentesque metus donec ipsum Tristique etiam parturient sapien. Arcu aptent. Interdum. Luctus vulputate luctus bibendum risus lectus magna. Eros sociosqu fermentum, ornare iaculis vehicula leo per arcu commodo, bibendum. Aliquet, potenti per. Luctus ridiculus, leo. Semper interdum sem fusce massa eu Duis quam class mus accumsan justo. Sagittis natoque congue Morbi justo, eget mollis suspendisse eros lectus a hymenaeos aptent magnis diam vulputate lorem quisque placerat inceptos eget placerat massa hymenaeos condimentum sodales aliquam, rutrum at quisque litora convallis leo. Dictum congue egestas maecenas elit Vestibulum nunc auctor arcu. Pellentesque massa et porttitor. Convallis donec metus sagittis netus vel lacus, sociosqu. Tempor per laoreet. Venenatis ullamcorper fringilla. Purus purus, sociis natoque viverra aenean nisl est condimentum congue penatibus a conubia scelerisque sagittis magnis hendrerit vulputate mattis. Lorem facilisi nonummy at ligula sagittis pede Dis, hymenaeos integer sociis mauris etiam cubilia condimentum sodales metus hac vestibulum lacus rhoncus in luctus. Hac eros ligula. Eu, eu nisl convallis Cum tellus semper penatibus proin tempus augue metus tempor semper neque curabitur turpis mollis, lectus lacus faucibus suscipit ut quis massa, ultricies habitant purus pharetra faucibus et nunc nullam Arcu felis placerat sed dis orci nisl tristique cum a. Venenatis ad, primis venenatis ornare lacinia quis dis nisi Cras. Fermentum porttitor elementum velit aliquam dignissim, inceptos volutpat placerat sociosqu sapien neque vitae auctor dapibus nibh tincidunt. Malesuada. Condimentum duis aliquet vehicula rhoncus. Eu, dapibus feugiat duis felis accumsan parturient tortor tristique dui est. Gravida molestie mus. Magnis volutpat dictum. Laoreet habitant torquent. Mus tempor tristique non. Scelerisque sollicitudin nulla mollis maecenas aptent montes Ornare tincidunt venenatis aliquam. Auctor. Varius facilisis suscipit. Habitant. Hymenaeos Commodo suspendisse. Scelerisque nisl dis habitasse dolor pulvinar vivamus tellus sociis, quis. Phasellus. Hendrerit eros malesuada aptent malesuada vulputate. Dui nec nibh netus ut facilisi ut bibendum penatibus euismod nonummy hac imperdiet rhoncus rutrum justo faucibus porta mauris Eget sed nec ipsum, commodo cras sagittis. Ligula primis enim. Ultricies potenti nullam montes. Aptent gravida egestas aptent. Erat laoreet cum libero habitant nullam dictum. Id pharetra lectus ipsum nullam. Nibh gravida a facilisis nam non vitae commodo dis nisl ullamcorper ut amet eget platea leo Ultricies habitant suscipit class integer nam tellus ultricies inceptos posuere dis donec pretium. Parturient, morbi porta molestie sodales nulla dolor, facilisis dictumst orci nunc quisque, at nibh odio nisl facilisis porta aliquam nullam. Lorem luctus dui aenean ut montes volutpat nostra ultricies aliquam dictumst purus Leo habitasse donec. Inceptos maecenas potenti. Montes sapien non rutrum. Sollicitudin. Eleifend convallis nibh consectetuer lacinia donec natoque turpis scelerisque netus hendrerit ut. Non morbi aliquam platea porttitor dictum, odio eget urna Tempor habitasse blandit taciti. Potenti praesent condimentum dignissim sem mollis tempus mus tempor ut integer. Elit morbi eleifend tellus auctor sollicitudin feugiat nulla Platea etiam Mollis mi quisque dis inceptos elit dui mattis luctus, morbi non feugiat luctus non lacus conubia ornare ac adipiscing Egestas nascetur ipsum per pretium. Facilisi mi a semper montes nam neque a mollis a vehicula sodales hymenaeos convallis ipsum lacus tempus ipsum metus auctor At semper dignissim morbi natoque nisi consequat. Convallis. Platea turpis facilisis imperdiet ad. Potenti erat eros pellentesque mollis nam ante egestas porta ut litora erat commodo euismod facilisis felis vulputate Enim cum accumsan. Magna libero enim nec hymenaeos habitasse enim primis nunc tristique duis interdum Volutpat pharetra phasellus dictumst cubilia habitant aliquam. Faucibus sollicitudin iaculis odio lorem mattis erat dis platea metus enim morbi dictum tempor nibh, vel, accumsan. Hymenaeos viverra. Primis augue netus tempus etiam convallis sagittis consectetuer magna viverra ultrices suscipit quis. Nibh pharetra vivamus aenean sed quis. Nibh vivamus. Vestibulum rutrum urna laoreet sem lectus nec in hymenaeos. Hymenaeos fames, elementum molestie Ultrices cursus vestibulum morbi malesuada adipiscing suscipit, dapibus lobortis proin. Neque rhoncus interdum ligula pretium pulvinar consectetuer ad commodo etiam varius dictum aenean turpis ad sem. Sagittis dignissim luctus natoque magnis pretium duis cubilia maecenas potenti id malesuada dolor primis tincidunt nec cras tempor mattis sodales dapibus blandit ipsum donec senectus. Eget sed condimentum facilisis pretium dignissim turpis viverra cubilia montes porttitor Arcu tristique imperdiet vulputate auctor. Porttitor et nec mi imperdiet primis pulvinar a curabitur, ridiculus aenean. Inceptos semper pharetra faucibus, faucibus suspendisse. Mollis egestas platea iaculis hymenaeos conubia elementum elit mollis. Mattis, primis vel torquent arcu. Torquent, lacinia vitae feugiat vestibulum netus metus phasellus. Arcu suscipit fermentum habitasse gravida pellentesque conubia eleifend tellus at eros mauris. Mus in primis ornare senectus, commodo amet. Mi dictumst netus facilisi donec per elit, diam Orci sodales hac fringilla fames gravida sed nostra natoque curae; gravida. Condimentum litora. Libero nec rhoncus tortor sem mus vel dictum quam purus nec libero rhoncus duis quisque. Dignissim natoque elit tortor elit scelerisque orci maecenas consectetuer arcu, nunc sociosqu netus dis taciti habitasse porta nostra dui nonummy dictum fringilla integer, mus eleifend id enim consectetuer sodales. Ultrices commodo habitasse consequat sociosqu praesent ullamcorper massa hymenaeos torquent ridiculus, proin volutpat facilisi, augue lectus iaculis nisi. Habitasse semper purus porta cursus laoreet feugiat eros ullamcorper ullamcorper. Ut nulla nibh, phasellus parturient commodo ligula dignissim facilisi et ad. Quam enim. Magnis magna sit nostra nisl erat dictumst conubia ornare tortor pharetra faucibus mi magna ultrices proin netus parturient ultrices sapien. Penatibus cubilia proin arcu at enim eros cum et penatibus quisque dictumst tempus natoque nunc potenti orci erat sed diam curae; aliquet iaculis venenatis quis. Vestibulum velit accumsan euismod sit. Id. Curae; conubia metus platea primis Taciti enim purus ridiculus viverra viverra adipiscing. Turpis erat torquent semper, nunc ut netus platea vitae eu dui posuere posuere tempor turpis non pulvinar dapibus. Torquent tempor ligula. Aliquam morbi, faucibus consectetuer, pede torquent ornare non. Nisi vestibulum congue nunc risus aliquam tempor ipsum dictum dis. Nonummy nec. Blandit. Lobortis eget luctus ullamcorper rhoncus natoque feugiat ornare aenean lacinia imperdiet suspendisse. Quisque penatibus maecenas accumsan sociosqu vehicula aliquam aliquam porta facilisi consectetuer pretium platea quisque viverra elit egestas sollicitudin vivamus, nibh nullam potenti fringilla nisi tristique, suspendisse augue pharetra et Lectus molestie rutrum neque morbi auctor posuere urna torquent suspendisse mus tempor mus euismod, posuere curabitur netus diam. Faucibus. Vel consectetuer cras magna euismod luctus pretium Aenean potenti lobortis nibh conubia. Dui sollicitudin condimentum sollicitudin fames ridiculus semper porttitor potenti magna semper ut fusce erat sit in proin eleifend lorem metus, nunc tincidunt ante. Vel eget blandit. Suscipit sociis tempus. Leo fusce habitant tortor pretium. Sodales molestie urna tempus. Id quam. Convallis habitant massa erat facilisi dolor nonummy consequat libero quisque id vel mus inceptos feugiat class magnis, felis dis. Quis, dolor parturient hymenaeos orci, scelerisque amet nec. Ac habitasse montes curabitur dignissim Praesent blandit litora tortor. Nullam risus dapibus justo lacinia integer velit est vivamus sodales massa auctor maecenas semper et suscipit porta leo volutpat iaculis neque dolor fusce. Commodo faucibus diam. Pretium semper urna, commodo vitae mattis curae;. Sociis scelerisque amet dictumst. Dis sociis tincidunt eleifend. Amet turpis nostra tempus. Fermentum a dui varius suspendisse ultrices dis iaculis. Tortor feugiat nascetur. Magnis Tempus a morbi magnis. Facilisi ornare gravida tortor. Libero ullamcorper ridiculus, metus, hendrerit massa integer leo hymenaeos eleifend semper maecenas. Magna ullamcorper per luctus gravida est elit euismod dui senectus tortor fringilla accumsan massa primis eleifend fringilla sed, molestie proin rhoncus sodales torquent nisl auctor ullamcorper elit tortor mattis viverra per tortor nascetur. Aliquam. Taciti, dictumst felis. Congue tristique ullamcorper commodo bibendum volutpat habitant suspendisse tempor, sollicitudin feugiat ipsum habitant tempus quis, tempor in. Quam rutrum iaculis et fringilla molestie erat. Lectus neque euismod porta Ipsum. Ad vehicula a laoreet. Leo nascetur placerat eros maecenas. Magnis. Proin. Nonummy. Diam commodo ipsum ad integer sollicitudin vulputate integer eros id nisi eleifend congue. Faucibus erat ornare ipsum ullamcorper eu id rutrum, aptent dictumst, lobortis posuere dui parturient netus gravida orci montes a vivamus facilisi augue varius. Lacus nibh sem etiam quisque. Imperdiet donec feugiat dictumst integer convallis maecenas vehicula rutrum scelerisque natoque habitant porta eget. Donec habitasse elementum senectus fringilla sodales ridiculus habitasse elementum sagittis bibendum placerat sem mattis nascetur elit sociis integer interdum. Felis Nisl rhoncus consequat Montes. Augue erat. Integer aenean bibendum donec interdum donec iaculis urna. Id. Feugiat convallis quisque habitant nullam quis dui ipsum mattis commodo sociis facilisis sagittis fusce facilisis sodales sed diam morbi nonummy curabitur. Porta facilisis suspendisse auctor lectus blandit gravida lacinia class hendrerit porttitor montes class eros in. Pharetra sit eget Odio curabitur tellus quam fames rutrum fusce elit mi conubia potenti a vel netus pretium. Orci, dis. Fames, eu nulla placerat erat id feugiat felis. Adipiscing purus, ante hymenaeos, conubia ac venenatis per habitant. Laoreet lorem condimentum eleifend Ultrices iaculis. Pulvinar sociosqu lacinia curae;. Quam tempor metus pede ligula aliquet curabitur senectus. Feugiat ornare hac aliquet vitae cubilia venenatis, conubia natoque pellentesque per euismod pellentesque feugiat suspendisse commodo felis luctus phasellus odio et metus id leo. Mi non tincidunt penatibus enim cubilia fames phasellus primis odio nullam. Dolor scelerisque Eleifend imperdiet viverra. Erat integer cras justo primis tristique morbi orci cubilia quam quisque sed arcu, scelerisque Convallis arcu, non ante eu non taciti quis elementum feugiat lectus varius congue, in sapien nec tortor commodo augue interdum. Vivamus aliquet sodales hendrerit interdum ut class a, lobortis fringilla netus aliquet pede. Ornare, dapibus volutpat blandit amet nec. Convallis tempus. Curae; viverra potenti mauris. Velit ullamcorper nisl ac mus aliquam nam accumsan torquent cras velit sem elit, phasellus euismod donec dis feugiat malesuada nam ligula adipiscing sociosqu pellentesque pharetra dignissim facilisis commodo tempus magnis rhoncus accumsan curabitur, habitant tempor nostra. Class vulputate at sociosqu. Sapien gravida, sed pulvinar pharetra nec integer neque maecenas vestibulum, ligula. Lectus sed. Sapien, duis consequat vulputate aliquet lacus erat nunc pellentesque sociis primis etiam tellus id ridiculus scelerisque lacinia est bibendum amet ultricies penatibus proin Vestibulum. Orci ac aptent sem. Laoreet egestas vitae dictum tellus lorem proin a commodo turpis curae; pharetra facilisi nascetur tristique mus. Eros sociosqu lacus. Dictumst. Cum ut. Donec eu conubia lacus phasellus, dui fames facilisis risus blandit cras odio phasellus semper aliquam metus eros adipiscing lorem, lectus bibendum Felis diam in urna blandit habitasse neque nullam sapien turpis vivamus iaculis senectus metus nec pede, pellentesque fames nec molestie commodo porttitor lacinia porta elementum. Sodales curabitur pretium rhoncus volutpat pellentesque luctus. Cubilia hendrerit interdum quam per natoque egestas diam rutrum quisque libero. Cras consequat pretium donec cum nascetur ullamcorper, pretium vel vehicula ullamcorper platea sociosqu. Varius per nunc convallis tortor. Aptent fusce. Nec Ridiculus eu mus parturient ligula gravida. Ante nullam. Sagittis nec habitant metus proin blandit risus molestie venenatis consectetuer rutrum nec nunc primis gravida litora ornare quis ultricies nisi diam torquent massa adipiscing enim pharetra lectus ipsum sagittis pede, at maecenas rutrum netus sociis dis eget montes volutpat Volutpat taciti, vulputate nec. Sagittis scelerisque mauris mus vestibulum dictumst vestibulum quis. Vel leo blandit, vulputate mi parturient blandit tempor fusce quam mattis luctus porta aptent primis. Nullam interdum. Quisque. Amet sit sodales id odio. Massa facilisi egestas tellus natoque sed proin mattis. Commodo. Lobortis fermentum. Penatibus. Sociis a molestie molestie fermentum nisl nulla nascetur hymenaeos posuere dictum rhoncus quam adipiscing massa ridiculus sit condimentum iaculis. Lorem ad viverra dolor euismod natoque placerat iaculis mattis nisl conubia varius, commodo semper lacus eros parturient massa tristique pulvinar sit dictumst fermentum. Nonummy. Nam mauris cum. Accumsan platea ad venenatis nunc pretium quam, lobortis natoque lacus sed bibendum velit nisi vestibulum nunc, iaculis elementum Vitae amet quis nunc sociis dapibus magnis metus proin dictumst arcu at faucibus laoreet cum accumsan. Ultricies platea congue dis morbi ultrices magna at aenean. Lectus nisl fringilla lacus consectetuer porta. Elit inceptos commodo gravida lectus tellus aptent morbi tempor inceptos pede vel turpis accumsan Primis lacinia justo aptent inceptos nisl. Facilisi erat ligula semper habitant nunc quisque augue risus feugiat quisque magnis. Conubia ligula curae; eros venenatis in ultricies aenean gravida vulputate varius vulputate, parturient quisque metus facilisis mi etiam mus. Nec velit vel maecenas netus, sollicitudin justo amet aenean sed. Sed inceptos sagittis risus fringilla placerat cubilia ridiculus etiam ridiculus sagittis. Nibh auctor orci habitasse tempus mattis hymenaeos hendrerit curabitur habitant. Lorem Potenti interdum odio pretium molestie iaculis nostra. Ac nulla orci augue. Quis enim fames venenatis nam eget hac senectus porttitor quis ac placerat vivamus Euismod vulputate magna platea aliquet mi etiam eleifend blandit purus aptent morbi nunc diam proin lacus potenti. Augue hac suscipit convallis viverra litora justo, rutrum eros porta quam fringilla lectus integer fermentum quis potenti orci a sed suscipit penatibus per maecenas penatibus elit ultricies placerat cubilia, ad hac turpis interdum etiam netus non et neque nascetur netus, sollicitudin tortor condimentum lorem. Laoreet potenti mollis duis."

switch = {
    "cat": "images/cat1_1638x2048_bmp.bmp",
    "greek1": "images/greek1_1296x700.jpg",
    "greek2": "images/greek2_1920x1080_bmp.bmp",
    "scenic1": "images/scenic1_1920x1080_jpg.jpg",
    "scenic2": "images/scenic2_2200x1200_jpg.jpg"
}
print "Choose Image to encrypt"
print switch.keys()
choice = raw_input()
try:
    myImg = cv2.imread(switch[choice])
except:
    print "Wrong choice, please run again"
    exit()

myImg = myImg[:, :, ::-1]

text = raw_input("Enter data to encrypt ")
print
    
dims = myImg.shape
bytesAmountToEncrypted = long(len(text) * 4)
if bytesAmountToEncrypted > (dims[0] * dims[1] * dims[0] - 64):
    print ("ERROR, Data is too long for this Image")
else:
    if text is not "":
        img = methods.encrypteImageSize(myImg.copy(), bytesAmountToEncrypted)
        img = methods.encrypteImage(img, text)
    else:
        print "Data was not entered"
        print "Run again and enter data"
        exit()

    print "Encrypted data from image:"
    print methods.decrypteImage(img)
    print
    print "Difference between images = " + str(np.sum(myImg - img))

    plt.figure()

    plt.subplot(121)
    plt.imshow(myImg)
    plt.title("Original Image")

    plt.subplot(122)
    plt.imshow(img)
    plt.title("Encrypted Image")

    myImgHisto = methods.calcHistogram(myImg)
    imgHisto = methods.calcHistogram(img)

    for i in range(256):
        if myImgHisto[i] != imgHisto[i]:
            print "Value " + str(i)
            print "Amount " + str(myImgHisto[i]) + " != " + str(imgHisto[i])
            print
    difference = myImgHisto - imgHisto

    plt.figure()
    plt.subplot(121)
    plt.bar(range(256), myImgHisto)
    plt.title("Original Image")

    plt.subplot(122)
    plt.bar(range(256), imgHisto)
    plt.title("Encrypted Image")

    plt.show()



